Object.size=function(c){var b=0,a;for(a in c){if(c.hasOwnProperty(a)){b++}}return b};var getUrl=function(b){var a=b.split("/")[2]||b.split("/")[0];a=a.replace("www.","");if(a==="localhost"||(a.indexOf(".")>0&&a.indexOf(" ")<=0&&CheckIsValidDomain(a))){return a}return""};var CheckIsValidDomain=function(b){var a=new RegExp(/^((?:(?:(?:\w[\.\-\+]?)*)\w)+)((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,6})$/);return b.match(a)};var externalManager={add:function(d,e){var a="PostIt_"+parseInt(d.id,10);var b=JSON.stringify(d);var c={};c[a]=b;if(Object.size(c[a])>=chrome.storage.sync.QUOTA_BYTES_PER_ITEM){e("The note cannot be saved because the quota bytes per item is exceeded!\n\nQUOTA_BYTES_PER_ITEM: "+chrome.storage.sync.QUOTA_BYTES_PER_ITEM+"Bytes\nNOTE_SIZE: "+Object.size(c[a])+"Bytes")}else{chrome.storage.sync.set(c,function(){if(e!=null){e("")}})}},get:function(d,c){var b;var a="PostIt_"+parseInt(d,10);chrome.storage.sync.get(null,function(e){if(e[a]!==undefined){b=JSON.parse(e[a])}else{b=""}if(c!=null){c(b)}})},remove:function(a,b){a="PostIt_"+parseInt(a,10);chrome.storage.sync.remove(a,function(){if(b!=null){b()}})},removeDom:function(c,h){var b=-1;var e=0;var a=false;if(c===undefined||typeof c==="function"){h=c;c={domain:window.location.origin,page:window.location.pathname}}var g=c.domain;var f=c.page;var d=this;d.getlength(function(j){if(!j){h();return}for(var k=1;k<=j;k++){d.key(k,function(i){d.getByKey(i,function(l){if(l!=null){if($.fn.postitall.globals.filter=="domain"){a=(getUrl(l.domain)===getUrl(g))}else{if($.fn.postitall.globals.filter=="page"){a=(getUrl(l.domain)===getUrl(g)&&(l.page===f||f===undefined))}else{a=true}}if(a){d.remove(l.id)}}if(e==(j-1)&&h!=null){h();h=null}e++})})}})},clear:function(e){var b=-1;var d=0;var a=false;var c=this;c.getlength(function(f){if(!f){e();return}for(var g=1;g<=f;g++){c.key(g,function(h){c.getByKey(h,function(i){if(i!=null){c.remove(i.id)}if(d==(f-1)&&e!=null){e();e=null}d++})})}})},getlength:function(b){var a=0;chrome.storage.sync.get(null,function(c){a=Object.keys(c).length;b(a)})},key:function(b,c){var a="PostIt_"+parseInt(b,10);chrome.storage.sync.get(null,function(d){if(d[a]!==undefined){c(a)}else{c("")}})},view:function(){console.log("view chrome");chrome.storage.sync.get(null,function(a){console.log(a)})},getByKey:function(a,b){if(a!=null&&a.slice(0,7)==="PostIt_"){a=a.slice(7,a.length);this.get(a,b)}else{if(b!=null){b(null)}}},getAll:function(e){var a=-1;var d=0;var c=[];var b=this;b.getlength(function(f){if(!f){e(c);return}for(var g=1;g<=f;g++){b.key(g,function(h){b.getByKey(h,function(i){c[i.id]=i;if(d==(f-1)&&e!=null){e(c);e=null}d++})})}})}};